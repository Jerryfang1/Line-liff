<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>會員卡 - 金玥銀樓</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; display: none; }
        .card h2 { margin-top: 0; color: #bfa76f; }
        #loading { font-size: 18px; }
    </style>
</head>
<body>
    <div id="loading">🔄 載入中，請稍候...</div>
    <div class="card" id="memberCard">
        <h2>歡迎，<span id="displayName"></span>！</h2>
        <p><strong>LINE ID：</strong><span id="userId"></span></p>
        <p><strong>會員點數：</strong><span id="points">查詢中...</span> 點</p>
    </div>

    <script>
        async function main() {
            await liff.init({ liffId: "YOUR_LIFF_ID" });  // <-- 請替換為你的 LIFF ID

            if (!liff.isLoggedIn()) {
                liff.login();
                return;
            }

            const profile = await liff.getProfile();
            const userId = profile.userId;
            const displayName = profile.displayName;

            await fetch("/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userId, displayName })
            });

            const res = await fetch(`/api/member?userId=${userId}`);
            const data = await res.json();

            document.getElementById("displayName").innerText = data.display_name;
            document.getElementById("userId").innerText = userId;
            document.getElementById("points").innerText = data.points;

            document.getElementById("loading").style.display = 'none';
            document.getElementById("memberCard").style.display = 'block';
        }

        main();
    </script>
</body>
</html>
